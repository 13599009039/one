# 系统功能测试计划

**项目**: 企业资源计划管理系统 (ERP)  
**版本**: 14.1  
**测试日期**: 2026年2月11日  
**测试目的**: 验证系统在真实业务场景下的完整性和正确性

---

## 📋 测试目标

### 核心测试目标

1. **业务流程完整性**: 验证不同业务场景下的数据流转
2. **数据一致性**: 确保财务数据、库存数据等关键数据准确无误
3. **权限控制**: 验证不同角色的权限隔离和功能访问
4. **异常处理**: 测试退款、退货等特殊业务场景
5. **数据修改**: 验证商品、成本、库存等数据的变更逻辑

---

## 🎯 测试场景列表

### 场景1: 先收款后签约（预付款模式）

**业务描述**: 客户先支付定金或全款，然后再签订正式合同

**测试步骤**:
1. 录入客户信息（状态：跟进中）
2. 录入收款流水（预收款）
3. 创建订单（关联预收款）
4. 生成任务到任务池
5. 任务接单并执行
6. 登记任务成本
7. 完成任务
8. 验证财务数据（收入-成本=利润）

**预期结果**:
- 收款时间早于订单创建时间
- 财务流水中预收款与订单关联
- 利润计算正确

**测试数据**:
- 客户: XX餐厅
- 预收款: ¥5,000（2026-02-01）
- 订单日期: 2026-02-05
- 合同金额: ¥5,000
- 服务: 短视频拍摄×1

---

### 场景2: 先签约后收款（赊账模式）

**业务描述**: 先签订合同开始服务，完成后客户再付款

**测试步骤**:
1. 录入客户信息
2. 创建订单（未收款状态）
3. 生成任务
4. 任务执行并登记成本
5. 完成任务
6. 后期录入收款流水
7. 验证应收账款计算

**预期结果**:
- 订单创建时间早于收款时间
- 显示应收账款金额
- 收款后应收账款清零

**测试数据**:
- 客户: YY美容院
- 订单日期: 2026-02-01
- 合同金额: ¥8,000
- 收款日期: 2026-02-28
- 应收账款期: 27天

---

### 场景3: 退款退货流程

**业务描述**: 客户要求退款或服务不满意需要重做

**测试子场景**:

#### 3.1 全额退款（未开始服务）
**测试步骤**:
1. 创建订单并收款
2. 客户要求退款（未开始执行）
3. 录入退款流水（负数）
4. 订单标记为"已退款"
5. 验证财务数据

**预期结果**:
- 退款流水金额为负数
- 订单状态显示"已退款"
- 账户余额扣减正确
- 不影响其他订单统计

#### 3.2 部分退款（服务已完成部分）
**测试步骤**:
1. 订单执行到一半
2. 客户要求退部分款
3. 录入部分退款流水
4. 调整订单金额
5. 验证成本和利润计算

**预期结果**:
- 订单金额调整为实际金额
- 利润 = 实际收入 - 已发生成本
- 退款记录清晰可查

#### 3.3 售后重做（不退款）
**测试步骤**:
1. 订单完成后客户不满意
2. 添加售后记录
3. 创建新任务（重做）
4. 登记重做成本
5. 完成售后任务

**预期结果**:
- 售后记录关联原订单
- 重做成本计入原订单
- 利润相应减少

---

### 场景4: 商品修改与成本变更

**业务描述**: 服务项价格调整、成本补录、成本修正

**测试子场景**:

#### 4.1 服务项价格调整
**测试步骤**:
1. 在服务项管理中创建服务项（价格A）
2. 创建订单使用该服务项
3. 修改服务项价格为B
4. 验证已有订单不受影响
5. 创建新订单使用新价格

**预期结果**:
- 历史订单价格不变
- 新订单使用新价格
- 价格变更有历史记录

#### 4.2 任务成本补录
**测试步骤**:
1. 任务执行中登记部分成本
2. 后期发现遗漏，补录成本
3. 验证总成本计算
4. 验证利润重新计算

**预期结果**:
- 成本可多次补录
- 总成本 = Σ所有成本记录
- 利润自动更新

#### 4.3 成本修正（错误更正）
**测试步骤**:
1. 发现之前登记的成本金额错误
2. 修改或删除错误成本记录
3. 验证利润重新计算

**预期结果**:
- 支持成本记录的修改/删除
- 利润实时更新
- 保留操作日志

---

### 场景5: 库存变更与出入库

**业务描述**: 物料采购、库存消耗、盘点调整

**测试子场景**:

#### 5.1 采购入库
**测试步骤**:
1. 创建供应商
2. 创建采购单（采购物料）
3. 录入采购流水（支出）
4. 验证库存增加
5. 验证账户余额减少

**预期结果**:
- 库存数量 = 原库存 + 采购数量
- 库存金额 = 原金额 + 采购金额
- 财务支出流水正确

#### 5.2 任务领用出库
**测试步骤**:
1. 任务执行时领用物料
2. 登记物料成本
3. 库存自动扣减
4. 验证任务成本计算

**预期结果**:
- 库存数量减少
- 物料成本计入任务成本
- 库存可追溯到具体任务

#### 5.3 库存盘点调整
**测试步骤**:
1. 实物盘点发现差异
2. 录入盘盈/盘亏
3. 调整库存数量
4. 生成盘点报告

**预期结果**:
- 库存调整有记录
- 盘盈盘亏可查询
- 影响财务报表

---

### 场景6: 权限控制测试

**业务描述**: 不同角色用户的功能访问和数据权限

**测试角色**:

#### 6.1 超级管理员 (super_admin)
**权限范围**: 全部功能

**测试步骤**:
1. 登录超级管理员账户
2. 验证可访问所有模块
3. 验证可查看所有公司数据
4. 验证可以添加/编辑/删除所有数据

**预期结果**: 无任何功能限制

#### 6.2 公司管理员 (admin)
**权限范围**: 本公司全部功能

**测试步骤**:
1. 登录公司管理员账户
2. 验证只能看到本公司数据
3. 验证可以管理本公司的客户、订单、财务
4. 验证无法访问其他公司数据

**预期结果**: 数据隔离正确

#### 6.3 财务人员 (financial)
**权限范围**: 财务模块

**测试步骤**:
1. 登录财务人员账户
2. 验证可以查看客户信息
3. 验证可以查看订单信息
4. 验证可以管理财务流水
5. 验证无法接单、无法管理组织架构

**预期结果**: 功能限制正确

#### 6.4 运营人员 (operation)
**权限范围**: 业务模块

**测试步骤**:
1. 登录运营人员账户
2. 验证可以管理客户
3. 验证可以管理订单
4. 验证可以接单和执行任务
5. 验证无法查看财务流水明细

**预期结果**: 财务数据不可见

#### 6.5 只读用户 (viewer)
**权限范围**: 仅查看

**测试步骤**:
1. 登录只读用户账户
2. 验证可以查看各模块数据
3. 验证所有新增/编辑/删除按钮不可用
4. 尝试直接调用API修改数据

**预期结果**: 完全只读，无法修改

---

## 📊 测试数据准备

### 测试用户账户

| 用户名 | 密码 | 角色 | 姓名 | 公司 |
|--------|------|------|------|------|
| admin | 123456 | super_admin | 系统管理员 | - |
| test_admin | 123456 | admin | 测试管理员 | 许昌爱佳 |
| test_finance | 123456 | financial | 测试财务 | 许昌爱佳 |
| test_operation | 123456 | operation | 测试运营 | 许昌爱佳 |
| test_viewer | 123456 | viewer | 测试观察员 | 许昌爱佳 |

### 测试客户数据

| 客户ID | 客户名称 | 行业 | 状态 | 跟进人 |
|--------|---------|------|------|--------|
| C001 | XX餐厅 | 餐饮 | 合作中 | 测试运营 |
| C002 | YY美容院 | 美容美发 | 合作中 | 测试运营 |
| C003 | ZZ汽修店 | 汽车服务 | 跟进中 | 测试运营 |

### 测试订单数据

| 订单号 | 客户 | 金额 | 场景 | 备注 |
|--------|------|------|------|------|
| ORD001 | XX餐厅 | ¥5,000 | 先收款后签约 | 预付全款 |
| ORD002 | YY美容院 | ¥8,000 | 先签约后收款 | 月结30天 |
| ORD003 | ZZ汽修店 | ¥3,000 | 退款测试 | 客户取消 |

### 测试服务项数据

| 服务名称 | 类型 | 单价 | 备注 |
|---------|------|------|------|
| 短视频拍摄 | 基础套餐 | ¥3,000 | 10条视频 |
| 直播代运营 | 月度套餐 | ¥5,000 | 每月30场 |
| 广告投放 | 按效果 | ¥8,000 | 包含投放费 |

### 测试物料库存

| 物料名称 | 初始库存 | 单价 | 备注 |
|---------|---------|------|------|
| 补光灯 | 5个 | ¥500 | 拍摄设备 |
| 三脚架 | 10个 | ¥200 | 拍摄设备 |
| 背景布 | 20卷 | ¥100 | 消耗品 |

---

## ✅ 测试验收标准

### 数据准确性

- [ ] 财务流水总额 = 所有收入流水 - 所有支出流水
- [ ] 账户余额 = 初始余额 + 总收入 - 总支出
- [ ] 订单利润 = 订单收入 - 任务成本
- [ ] 应收账款 = 未收款订单金额总和
- [ ] 库存数量 = 期初 + 入库 - 出库
- [ ] 库存金额 = Σ(数量 × 单价)

### 业务逻辑

- [ ] 先收款后签约：收款时间 < 订单时间
- [ ] 先签约后收款：订单时间 < 收款时间，显示应收账款
- [ ] 退款：负数流水，订单状态更新，数据统计排除
- [ ] 售后重做：成本增加，利润减少
- [ ] 价格调整：历史订单不变，新订单用新价
- [ ] 库存出库：任务成本自动关联物料成本

### 权限隔离

- [ ] super_admin: 无限制
- [ ] admin: 只能访问本公司数据
- [ ] financial: 可看财务，不能接单
- [ ] operation: 可接单，不能看详细财务
- [ ] viewer: 完全只读，所有操作按钮禁用

### 数据展示

- [ ] 仪表盘：实时更新统计数据
- [ ] 报表：各项统计准确
- [ ] 列表：分页、搜索、筛选正常
- [ ] 详情：完整显示所有关联数据

---

## 🔍 测试方法

### 1. 功能测试
- 手动执行每个测试场景
- 记录操作步骤和结果
- 截图保存关键界面

### 2. 数据验证
- SQL查询验证数据库记录
- 对比前端显示和数据库实际数据
- 检查数据一致性

### 3. 边界测试
- 输入极限值（最大金额、最小数量等）
- 特殊字符处理
- 并发操作测试

### 4. 异常测试
- 网络中断恢复
- 数据重复提交
- 非法数据输入

---

## 📝 测试记录模板

### 测试用例记录

```markdown
### 测试用例: [场景名称]

**测试时间**: 2026-02-11 10:30
**测试人员**: AI Assistant
**测试环境**: 生产服务器

#### 测试步骤

1. [步骤1]
   - 操作: [具体操作]
   - 预期: [预期结果]
   - 实际: [实际结果]
   - 状态: ✅通过 / ❌失败

2. [步骤2]
   ...

#### 测试结果

- 总步骤数: X
- 通过: Y
- 失败: Z
- 通过率: XX%

#### 发现问题

1. [问题描述]
   - 严重程度: 高/中/低
   - 影响范围: 
   - 复现步骤:
   - 建议修复:

#### 测试数据

- 客户ID: 
- 订单号: 
- 流水ID: 
- 任务ID:
```

---

## 📋 问题分类

### 严重等级定义

- **P0 - 致命**: 系统崩溃、数据丢失、无法使用核心功能
- **P1 - 严重**: 主要功能异常、数据计算错误、权限失效
- **P2 - 一般**: 次要功能问题、UI显示错误、性能缓慢
- **P3 - 轻微**: 文案错误、样式问题、优化建议

---

## 📆 测试时间安排

| 阶段 | 时间 | 内容 |
|------|------|------|
| 准备阶段 | 30分钟 | 创建测试账户、准备测试数据 |
| 场景1测试 | 20分钟 | 先收款后签约流程 |
| 场景2测试 | 20分钟 | 先签约后收款流程 |
| 场景3测试 | 30分钟 | 退款退货流程（3个子场景） |
| 场景4测试 | 25分钟 | 商品成本变更（3个子场景） |
| 场景5测试 | 30分钟 | 库存管理（3个子场景） |
| 场景6测试 | 40分钟 | 权限控制（5个角色） |
| 数据验证 | 30分钟 | SQL验证、报表核对 |
| 总结报告 | 15分钟 | 编写测试报告 |
| **总计** | **4小时** | |

---

## 🎯 成功标准

测试通过标准：
- [ ] 所有测试场景通过率 ≥ 95%
- [ ] 无P0、P1级别问题
- [ ] P2级别问题 ≤ 3个
- [ ] 所有数据准确性验证通过
- [ ] 权限控制100%正确

---

**测试计划制定完成时间**: 2026年2月11日  
**预计测试开始时间**: 立即开始  
**预计测试完成时间**: 2026年2月11日
